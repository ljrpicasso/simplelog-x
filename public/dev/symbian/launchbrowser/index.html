<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Simon Woodside | How to launch a browser from Symbian C++</title>
<meta name="author" lang="en" content="Simon Woodside" xml:lang="en" />
<meta name="description" lang="en" content="Simon Woodside's personal home page." xml:lang="en" />
<link rel="Stylesheet" href="/css/screen.css" type="text/css" media="screen" />
<link rel="Stylesheet" href="/css/print.css" type="text/css" media="print" />
<link rel="Stylesheet" href="/css/mobile.css" type="text/css" media="handheld" />
</head>
<body>
<div id="nocsstitlebox">
<b>Simon Woodside | How to launch a browser from Symbian C++</b>
<br />
<b><a href="#content">Skip to content</a> &gt;</b>
</div>
<div id="wrapper">
<div id="sidebarbox">
<div id="sidebarbox_inner">
<div id="bannerbox">
<a href="/">
<img src="/images/swclogo.gif" alt="SWC logo" style="border:none;" />
</a>
</div>
<div id="sitemenu">
<div class="sitemenuitem">
<a href="/weblog/">Simon Says</a>
</div>
<div class="sitemenuitem">
<a href="/dev/">Development</a>
</div>
<div class="sitemenuitem">
<a href="/content/">Content</a>
</div>
<div class="sitemenuitem">
<a href="/about/">About</a>
</div>
<br />
<div class="sitemenuitem">
<a href="mailto:sbwoodside@yahoo.com?subject=SimonWoodside.com">email</a>
</div>
</div>
<form method="get" action="http://www.google.com/search">
<div id="searchbox">
<input type="hidden" name="sitesearch" value="simonwoodside.com" />
<input type="text" name="q" maxlength="255" value="Search the site..." onblur="if(this.value=='') this.value='Search the site...';" onfocus="if(this.value=='Search the site...') this.value='';" />
</div>
</form>
<div id="related">
<div>
<b>
              Recent posts related to
              <a href="/weblog/tag/dev/symbian">dev/symbian</a>:
            </b>
</div>
<div xmlns:sax="http://simonwoodside.com/simon-axkit" class="weblog_entry_title">
<a href="/weblog/2005/04/03">HOWTO develop Symbian apps using Mac OS X</a>
</div>
<div xmlns:sax="http://simonwoodside.com/simon-axkit" class="weblog_entry_title">
<a href="/weblog/2005/04/02">Success! Built Symbian C++ app on OS X!</a>
</div>
<div xmlns:sax="http://simonwoodside.com/simon-axkit" class="weblog_entry_title">
<a href="/weblog/2005/01/21">psst - #symbian on freenode</a>
</div>
<div xmlns:sax="http://simonwoodside.com/simon-axkit" class="weblog_entry_title">
<a href="/weblog/2005/01/21">Unpack Nokia SDK 2.1 on Unix</a>
</div>
<div xmlns:sax="http://simonwoodside.com/simon-axkit" class="weblog_entry_title">
<a href="/weblog/2005/01/17">Installing UIQ on Linux / sdk2unix</a>
</div>
<div xmlns:sax="http://simonwoodside.com/simon-axkit" class="weblog_entry_title">
<a href="/weblog/2004/07/18">more symbian errata</a>
</div>
</div>
</div>
</div>
<div id="content">
<div id="navi">
<div id="pathbar"><span class="pathbaritem"><a href="/">Home</a></span> &gt; <span class="pathbaritem"><a href="/dev/">Software dev</a></span> &gt; <span class="pathbaritem">Symbian</span> &gt; <span class="pathbaritem"></span></div>
<div id="submenu">
<span class="submenuitem">
<a href="/dev/xml/">XML</a>
</span>
<span class="submenuitem">
<a href="/dev/symbian/">Symbian</a>
</span>
<span class="submenuitem">
<a href="/dev/mozilla/">Camino</a>
</span>
</div>
</div>
<div id="content_inner"><div id="titlebox"><h1 class="body_title">How to launch a browser from Symbian C++</h1></div>

<h2>Preamble / Rant</h2>

<p>So you want to launch a browser from your nifty Symbian C++ app. And you hit the 
brick wall. Symbian doesn't provide an API. Series 60 doesn't provide an API. UIQ doesn't
provide an API. You're all alone, lost in the wilderness with only feeble or non-existent
documentation to help you. I spent months doing this so now, you don't have to.
</p>

<h2>Read this</h2>

<h3>No URL resolution service</h3>

<p>As far as I know there is no ultra-clean way to do this. Symbian should have a 
system wide setting for "favorite browser" and a URL resolution service. But they don't.
</p>

<h3>No preferences</h3>

<p>My code doesn't include the ability to set a preference. You could probably do that.
</p>

<h3>No checking the presence of different apps</h3>

<p>My code doesn't check if Opera or whatever is actually there. I should probably do
that. I probably will for my next version. I don't know how or if it's possible but it
probably is possible to check the app registry or something to test for the apps.
</p>

<h3>On Series 60, I always choose Opera</h3>

<p>My needs are for a real HTML browser. At the time I last changed this code
none of the phones had a good built-in browser. So I would always default to Opera.
I test to see if the phone is an old 3650-style device, which don't consistently have the
memory to run Opera -- in that case I run Doris Browser, which is now archaic but was
good for its time and place.
</p>

<p>Times are changing. The latest Nokias (e.g. 6630) seem to have a good browser.
</p>

<h3>On UIQ, I always choose built-in browser</h3>

<p>The built-in browser on the UIQ phones (e.g. P900) was good enough for me from the get-go
so I just launch it.
</p>


<h2>Download Doris SDK</h2>

<p>In order to launch the Doris Browser you'll need these source files:
</p>
<ul>
<li><a href="files/doris_interface.h">doris_interface.h</a>
</li>
<li><a href="files/doris_interface.cpp">doris_interface.cpp</a>
</li>
</ul>



<h2>Copy my code</h2>

<h3>For Series 60</h3>

<p>Now we get to write some code.
</p>

<p>First, we need a mechanism to choose browsers based on what hardware we're running on.
We'll call them "WmlBrowser" (the built in browser which also sort-of does HTML); 
DorisBrowser; and
OperaBrowser.
</p>

<pre>
// UIDs of Browser applications
const TInt KWmlBrowserUid = 0x10008D39;
const TInt KOperaBrowserUid = 0x101F4DED;
//const TInt KDorisBrowserUid = 0x101f81a8;

// define this ONLY to OVERRIDE automatic browser selection
// comment it out otherwise
#define BROWSER_OVERRIDE EWmlBrowser
//EOperaBrowser
//EDorisBrowser
//EWmlBrowser
// from http://www.newlc.com/article.php3?id_article=161
const TInt K360036503660PhoneUid = 0x101f466a;
TBrowser BestBrowser() {
#ifdef BROWSER_OVERRIDE
  return BROWSER_OVERRIDE;
#else
  TInt mUid = 0;
  HAL::Get(HALData::EMachineUid, mUid);
  if( mUid == K360036503660PhoneUid )
    return EDorisBrowser;
  else
    return EOperaBrowser;
#endif
}
</pre>

<p>Now we have the method that starts the browser.
</p>

<pre>
/*
 * MyStartBrowser();
 * Start the correct browser and load the given URL into
 * that browser.
 */
void CMyClass::MyStartBrowser(const TDesC&amp; aUrl)
{
  HBufC* param = HBufC::NewL( 1024 );
  
  TBrowser browser = BestBrowser();
  
  TInt browserUid;
  switch( browser ) {
    case EWmlBrowser:
      browserUid = KWmlBrowserUid;
      break;
    case EOperaBrowser:
      browserUid = KOperaBrowserUid;
      break;
  }
  
  switch( browser ) {
    case EWmlBrowser:
    {
      // use the StartDocument api
      param-&gt;Des().Format( _L( "4 %S" ),&amp;aUrl );
      TUid id( TUid::Uid( browserUid ) );
      TApaTaskList taskList( CEikonEnv::Static()-&gt;WsSession() );
      TApaTask task = taskList.FindApp( id );
      if ( task.Exists() ) {
        HBufC8* param8 = HBufC8::NewL( param-&gt;Length() );
        param8-&gt;Des().Append( *param );
        task.SendMessage( TUid::Uid( 0 ), *param8 ); 
        // Uid is not used // CleanupStack::PopAndDestroy(); // param8
      }
      else {
        RApaLsSession appArcSession;
        User::LeaveIfError( appArcSession.Connect() ); // connect to AppArc server
        TThreadId id;
        appArcSession.StartDocument( *param, TUid::Uid(browserUid), id );
        appArcSession.Close();
      }
      break;
    }
    case EOperaBrowser:
    {
      param-&gt;Des().Format( _L("%S"), &amp;aUrl );
      HBufC8* param8 = HBufC8::NewL( param-&gt;Length() );
      param8-&gt;Des().Append( *param );
      TUid KMyUidOperaBrowser = {0x101F4DED};
      TVwsViewId viewId(KMyUidOperaBrowser, TUid::Uid(0));
      (STATIC_CAST(CAknAppUi*, CEikonEnv::Static()-&gt;AppUi()))-&gt;
          ActivateViewL(viewId, TUid::Uid(0), param8-&gt;Des() );
      break;
    }
    case EDorisBrowser:
    {
      //use the Doris browser interface
      param-&gt;Des().Format( _L("%S"), &amp;aUrl );
      CUtility::DebugPrint(_L("using EDorisBrowser"));
      CDorisBrowserInterface *ido = CDorisBrowserInterface::NewLC();
      ido-&gt;AppendL( CDorisBrowserInterface::EOpenURL_STRING, param-&gt;Des() );
      CUtility::DebugPrint(param-&gt;Des());
      ido-&gt;ExecuteL();
      CleanupStack::PopAndDestroy(ido);
      break;
    }
  }
}
</pre>

<p>After calling that, you might want to call this:
</p>

<pre>
      CBaActiveScheduler::Exit();
</pre>


<h2>UIQ</h2>

<p>This is really easy and uncomplicated.
</p>

<pre>
void CTCamAppUi::OpenBrowserL(const TDesC&amp; aURL)
{                 
  TQWebDNLUrlEntry url;
  url.iUrl = aURL;
  TQWebDNLUrlEntryBuf urlBuf( url );
  TVwsViewId viewId( KUidQWebApp, KUidQWebPageView );
  (STATIC_CAST(CEikAppUi*, CEikonEnv::Static()-&gt;
    AppUi()))-&gt;ActivateViewL( viewId, KQWebCustomMsgId, urlBuf );
}

</pre>

<p>Launches the built in browser.
</p>

  <div style="clear:both;"></div><div id="footerbox" style="font-family:sans-serif;"><p>Copyright Â© 
        1996-2007 Simon Woodside. If no license is noted, rights are reserved.</p><p><a href="http://validator.w3.org/check/referer">Valid XHTML 1.0 strict?</a>
        Made with 
        <a href="http://www.axkit.org/">AxKit</a>
        and
        <a href="http://simonwoodside.com/dev/xml/saxite">Saxite</a>.
      </p></div></div>
</div>
</div>
</body>
</html>
